{"version":3,"sources":["../src/props.ts"],"names":["noop","undefined","INITIAL_PROPS","title","sites","isLoading","onDeploy","props$","options","configuredSites","map","site","id","apiId","name","buildHookId","url","adminUrl","onDeploy$","setSitesAction$","pipe","type","deployAction$","deployResult$","deployCompletedAction$","result","error","stateReducer$","subscribe","description"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,IAAI,GAAG,MAAMC,SAAnB;;AAEA,IAAMC,aAAa,GAAG;AACpBC,EAAAA,KAAK,EAAE,eADa;AAEpBC,EAAAA,KAAK,EAAE,EAFa;AAGpBC,EAAAA,SAAS,EAAE,IAHS;AAIpBC,EAAAA,QAAQ,EAAEN;AAJU,CAAtB,C,CAOA;;AACO,IAAMO,MAAM,GAAIC,OAAD,IAA4B;AAChD,MAAMC,eAAe,GAAG,CAACD,OAAO,CAACJ,KAAR,IAAiB,EAAlB,EAAsBM,GAAtB,CAA2BC,IAAD,KAAW;AAC3DC,IAAAA,EAAE,EAAED,IAAI,CAACE,KADkD;AAE3DC,IAAAA,IAAI,EAAEH,IAAI,CAACG,IAFgD;AAG3DX,IAAAA,KAAK,EAAEQ,IAAI,CAACR,KAH+C;AAI3DY,IAAAA,WAAW,EAAEJ,IAAI,CAACI,WAJyC;AAK3DC,IAAAA,GAAG,EAAEL,IAAI,CAACK,GAAL,IAAaL,IAAI,CAACG,IAAL,sBAAwBH,IAAI,CAACG,IAA7B,kBALyC;AAM3DG,IAAAA,QAAQ,EAAEN,IAAI,CAACG,IAAL,4CAA8CH,IAAI,CAACG,IAAnD;AANiD,GAAX,CAA1B,CAAxB;;AADgD,4BAUlB,2CAVkB;AAAA;AAAA,MAUzCI,SAVyC;AAAA,MAU9BZ,QAV8B;;AAWhD,MAAMa,eAAe,GAAG,cAAGV,eAAH,EAAoBW,IAApB,CAAyB,oBAAKhB,KAAD,KAAY;AAACiB,IAAAA,IAAI,EAAE,UAAP;AAAmBjB,IAAAA;AAAnB,GAAZ,CAAJ,CAAzB,CAAxB;AACA,MAAMkB,aAAa,GAAGJ,SAAS,CAACE,IAAV,CAAe,oBAAKT,IAAD,KAAW;AAACU,IAAAA,IAAI,EAAE,gBAAP;AAAyBV,IAAAA;AAAzB,GAAX,CAAJ,CAAf,CAAtB;AACA,MAAMY,aAAa,GAAGL,SAAS,CAACE,IAAV,CAAe,0BAAWT,IAAD,IAAU,oBAAOA,IAAP,CAApB,CAAf,CAAtB;AACA,MAAMa,sBAAsB,GAAGD,aAAa,CAACH,IAAd,CAC7B,oBACGK,MAAD;AAAcJ,IAAAA,IAAI,EAAE;AAApB,KAA2CI,MAA3C,CADF,EAEE,2BAAYC,KAAD,IAAW,cAAG;AAACL,IAAAA,IAAI,EAAE,eAAP;AAAwBK,IAAAA;AAAxB,GAAH,CAAtB,CAFF,CAD6B,CAA/B;AAOA,mBAAMP,eAAN,EAAuBG,aAAvB,EAAsCE,sBAAtC,EAA8DJ,IAA9D,CAAmEO,uBAAnE,EAAkFC,SAAlF;AAEA,SAAO,cAAGnB,eAAH,EAAoBW,IAApB,CACL,oBAAKhB,KAAD,KAAY;AACdA,IAAAA,KADc;AAEdD,IAAAA,KAAK,EAAEK,OAAO,CAACL,KAAR,IAAiBD,aAAa,CAACC,KAFxB;AAGd0B,IAAAA,WAAW,EAAErB,OAAO,CAACqB,WAHP;AAIdxB,IAAAA,SAAS,EAAE,KAJG;AAKdC,IAAAA;AALc,GAAZ,CAAJ,CADK,EAQL,0BAAUJ,aAAV,CARK,CAAP;AAUD,CAjCM","sourcesContent":["import {merge, of} from 'rxjs'\nimport {createEventHandler} from 'react-props-stream'\nimport {catchError, map, startWith, switchMap} from 'rxjs/operators'\nimport {deploy} from './datastores/deploy'\nimport {Site, WidgetOptions} from './types'\nimport {stateReducer$} from './reducers'\n\nconst noop = () => undefined\n\nconst INITIAL_PROPS = {\n  title: 'Netlify sites',\n  sites: [],\n  isLoading: true,\n  onDeploy: noop,\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport const props$ = (options: WidgetOptions) => {\n  const configuredSites = (options.sites || []).map((site) => ({\n    id: site.apiId,\n    name: site.name,\n    title: site.title,\n    buildHookId: site.buildHookId,\n    url: site.url || (site.name && `https://${site.name}.netlify.app/`),\n    adminUrl: site.name && `https://app.netlify.com/sites/${site.name}`,\n  }))\n\n  const [onDeploy$, onDeploy] = createEventHandler<Site>()\n  const setSitesAction$ = of(configuredSites).pipe(map((sites) => ({type: 'setSites', sites})))\n  const deployAction$ = onDeploy$.pipe(map((site) => ({type: 'deploy/started', site})))\n  const deployResult$ = onDeploy$.pipe(switchMap((site) => deploy(site)))\n  const deployCompletedAction$ = deployResult$.pipe(\n    map(\n      (result) => ({type: 'deploy/completed', ...result}),\n      catchError((error) => of({type: 'deploy/failed', error}))\n    )\n  )\n\n  merge(setSitesAction$, deployAction$, deployCompletedAction$).pipe(stateReducer$).subscribe()\n\n  return of(configuredSites).pipe(\n    map((sites) => ({\n      sites,\n      title: options.title || INITIAL_PROPS.title,\n      description: options.description,\n      isLoading: false,\n      onDeploy,\n    })),\n    startWith(INITIAL_PROPS)\n  )\n}\n"],"file":"props.js"}